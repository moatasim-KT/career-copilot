groups:
  # =============================================================================
  # CRITICAL PRODUCTION ALERTS
  # =============================================================================
  
  - name: critical-production-alerts
    rules:
      - alert: ServiceCompletelyDown
        expr: up{job=~".*contract-analyzer.*"} == 0
        for: 30s
        labels:
          severity: critical
          service: contract-analyzer
          team: platform
          priority: P1
        annotations:
          summary: "üö® CRITICAL: Contract Analyzer service is completely down"
          description: "Service {{ $labels.job }} has been down for more than 30 seconds. This is a complete service outage."
          runbook_url: "https://docs.company.com/runbooks/service-down"
          dashboard_url: "https://grafana.company.com/d/prod-overview"
          escalation: "Immediately page on-call engineer"

      - alert: DatabaseCompletelyDown
        expr: up{job="postgres"} == 0
        for: 30s
        labels:
          severity: critical
          service: database
          team: platform
          priority: P1
        annotations:
          summary: "üö® CRITICAL: Database is completely down"
          description: "PostgreSQL database has been unreachable for more than 30 seconds"
          runbook_url: "https://docs.company.com/runbooks/database-down"
          escalation: "Immediately page database team and on-call engineer"

      - alert: ExtremelyHighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[2m]) / rate(http_requests_total[2m]) * 100 > 25
        for: 1m
        labels:
          severity: critical
          service: contract-analyzer
          team: backend
          priority: P1
        annotations:
          summary: "üö® CRITICAL: Extremely high error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }} over the last 2 minutes"
          runbook_url: "https://docs.company.com/runbooks/high-error-rate"
          escalation: "Page backend team immediately"

  # =============================================================================
  # HIGH PRIORITY PRODUCTION ALERTS
  # =============================================================================
  
  - name: high-priority-production-alerts
    rules:
      - alert: HighErrorRateProduction
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 10
        for: 2m
        labels:
          severity: warning
          service: contract-analyzer
          team: backend
          priority: P2
        annotations:
          summary: "‚ö†Ô∏è HIGH: Elevated error rate in production"
          description: "Error rate is {{ $value | humanizePercentage }} for the last 5 minutes"
          runbook_url: "https://docs.company.com/runbooks/elevated-error-rate"

      - alert: VeryHighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 5
        for: 3m
        labels:
          severity: warning
          service: contract-analyzer
          team: backend
          priority: P2
        annotations:
          summary: "‚ö†Ô∏è HIGH: Very high response times detected"
          description: "95th percentile response time is {{ $value }}s"
          runbook_url: "https://docs.company.com/runbooks/high-response-time"

      - alert: CriticalResourceExhaustion
        expr: |
          (
            (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 90
          ) or (
            100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 90
          ) or (
            (1 - (node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"})) * 100 > 90
          )
        for: 2m
        labels:
          severity: warning
          service: infrastructure
          team: platform
          priority: P2
        annotations:
          summary: "‚ö†Ô∏è HIGH: Critical resource exhaustion detected"
          description: "System resources are critically low on {{ $labels.instance }}"
          runbook_url: "https://docs.company.com/runbooks/resource-exhaustion"

  # =============================================================================
  # BUSINESS LOGIC ALERTS
  # =============================================================================
  
  - name: business-logic-alerts
    rules:
      - alert: ContractProcessingStalled
        expr: rate(contracts_processed_total[10m]) < 0.01
        for: 5m
        labels:
          severity: warning
          service: contract-analyzer
          team: backend
          priority: P3
        annotations:
          summary: "üìä BUSINESS: Contract processing has stalled"
          description: "Contract processing rate is {{ $value }} contracts/second over the last 10 minutes"
          runbook_url: "https://docs.company.com/runbooks/processing-stalled"

      - alert: AIAnalysisHighFailureRate
        expr: rate(ai_analysis_failures_total[5m]) / rate(ai_analysis_total[5m]) * 100 > 15
        for: 3m
        labels:
          severity: warning
          service: ai-analysis
          team: ml
          priority: P3
        annotations:
          summary: "ü§ñ AI: High AI analysis failure rate"
          description: "AI analysis failure rate is {{ $value | humanizePercentage }}"
          runbook_url: "https://docs.company.com/runbooks/ai-failures"

      - alert: UnusualUserActivity
        expr: rate(user_registrations_total[1h]) > 100 or rate(user_registrations_total[1h]) < 0.1
        for: 10m
        labels:
          severity: info
          service: user-management
          team: product
          priority: P4
        annotations:
          summary: "üë• USERS: Unusual user activity detected"
          description: "User registration rate is {{ $value }} registrations/hour"
          runbook_url: "https://docs.company.com/runbooks/unusual-activity"

  # =============================================================================
  # SECURITY ALERTS
  # =============================================================================
  
  - name: security-alerts
    rules:
      - alert: SuspiciousTrafficPattern
        expr: rate(http_requests_total{status="429"}[5m]) > 10
        for: 2m
        labels:
          severity: warning
          service: security
          team: security
          priority: P2
        annotations:
          summary: "üîí SECURITY: Suspicious traffic pattern detected"
          description: "High rate of 429 responses: {{ $value }} requests/second"
          runbook_url: "https://docs.company.com/runbooks/suspicious-traffic"

      - alert: UnauthorizedAccessAttempts
        expr: rate(http_requests_total{status="401"}[5m]) > 5
        for: 3m
        labels:
          severity: warning
          service: security
          team: security
          priority: P3
        annotations:
          summary: "üîí SECURITY: High rate of unauthorized access attempts"
          description: "Unauthorized access attempts: {{ $value }} attempts/second"
          runbook_url: "https://docs.company.com/runbooks/unauthorized-access"

  # =============================================================================
  # PERFORMANCE DEGRADATION ALERTS
  # =============================================================================
  
  - name: performance-alerts
    rules:
      - alert: DatabaseSlowQueries
        expr: pg_stat_statements_mean_time_ms > 1000
        for: 5m
        labels:
          severity: warning
          service: database
          team: backend
          priority: P3
        annotations:
          summary: "üêå PERF: Slow database queries detected"
          description: "Average query time is {{ $value }}ms"
          runbook_url: "https://docs.company.com/runbooks/slow-queries"

      - alert: CacheHitRateLow
        expr: redis_keyspace_hits_total / (redis_keyspace_hits_total + redis_keyspace_misses_total) * 100 < 80
        for: 5m
        labels:
          severity: info
          service: cache
          team: backend
          priority: P4
        annotations:
          summary: "üíæ CACHE: Low cache hit rate"
          description: "Cache hit rate is {{ $value | humanizePercentage }}"
          runbook_url: "https://docs.company.com/runbooks/low-cache-hit-rate"

  # =============================================================================
  # CAPACITY PLANNING ALERTS
  # =============================================================================
  
  - name: capacity-alerts
    rules:
      - alert: HighConcurrentUsers
        expr: active_connections > 1000
        for: 5m
        labels:
          severity: info
          service: contract-analyzer
          team: platform
          priority: P4
        annotations:
          summary: "üìà CAPACITY: High number of concurrent users"
          description: "Current active connections: {{ $value }}"
          runbook_url: "https://docs.company.com/runbooks/high-concurrency"

      - alert: DiskSpaceProjection
        expr: predict_linear(node_filesystem_avail_bytes{fstype!="tmpfs"}[6h], 24*3600) < 0
        for: 1h
        labels:
          severity: warning
          service: infrastructure
          team: platform
          priority: P3
        annotations:
          summary: "üíΩ CAPACITY: Disk space will be exhausted within 24 hours"
          description: "Disk {{ $labels.mountpoint }} on {{ $labels.instance }} will be full in ~24h"
          runbook_url: "https://docs.company.com/runbooks/disk-space-projection"