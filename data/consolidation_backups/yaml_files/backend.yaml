# Backend Configuration
# API and service-specific settings

# API Configuration
api:
  host: "0.0.0.0"
  port: 8002
  debug: false
  workers: 1
  timeout: 300
  max_request_size: 52428800  # 50MB
  reload: false

# Database Configuration
database:
  url: "sqlite+aiosqlite:///./data/contract_analyzer.db"
  pool_size: 5
  max_overflow: 10
  pool_timeout: 30
  pool_recycle: 3600
  echo: false
  pool_pre_ping: false
  migrations:
    auto_migrate: true
    backup_before_migrate: true
    script_location: "migrations"

# Vector Database (ChromaDB)
vector_db:
  persist_directory: "data/chroma"
  collection_name: "contract_embeddings"
  batch_size: 100
  similarity_threshold: 0.7

# Background Tasks
background_tasks:
  enabled: true
  max_workers: 2
  queue_size: 100
  retry_attempts: 3
  retry_delay: 1.0

# Task Routing Configuration
task_routing:
  default_criteria: "cost"
  cache_ttl: 3600
  max_retries: 3
  fallback_enabled: true
  circuit_breaker:
    threshold: 5
    timeout: 60

# Security Configuration
security:
  cors_origins:
    - "http://localhost:8501"
    - "http://localhost:8002"
    - "http://127.0.0.1:8501"
    - "http://127.0.0.1:8502"
  jwt:
    algorithm: "HS256"
    expiration_hours: 24
  rate_limiting:
    enabled: false
    requests_per_minute: 100
    burst: 200
  file_upload:
    max_size_mb: 50
    allowed_types:
      - "pdf"
      - "docx"
      - "txt"
    scan_files: true
  encryption:
    enabled: false
    algorithm: "AES-256-GCM"
  audit_logging: false
  ip_filtering: false
  csrf_protection: false

# Cache Configuration
cache:
  redis:
    enabled: false
    host: "localhost"
    port: 6379
    db: 0
    max_connections: 20
    timeout: 5
    password_required: false
  memory:
    enabled: true
    max_size: 1000
    ttl: 3600

# File Storage
storage:
  local:
    enabled: true
    path: "data/storage"
    max_size_mb: 1000
  backup:
    enabled: false
    retention_days: 30
    schedule: "0 2 * * *"

# Environment Overrides
environments:
  development:
    api:
      debug: true
      workers: 1
      reload: true
    database:
      echo: true
      pool_size: 2
      max_overflow: 5
    security:
      cors_origins:
        - "http://localhost:8501"
        - "http://localhost:8502"
        - "http://localhost:8503"
        - "http://localhost:3000"
        - "http://127.0.0.1:8501"
        - "http://127.0.0.1:8502"
        - "http://127.0.0.1:8503"
        - "http://127.0.0.1:3000"
      jwt:
        expiration_hours: 168  # 7 days
      rate_limiting:
        enabled: false
      file_upload:
        max_size_mb: 100
        scan_files: false
      encryption:
        enabled: false
    cache:
      redis:
        enabled: false
      memory:
        max_size: 500
        ttl: 1800
    background_tasks:
      max_workers: 1
      queue_size: 50
      
  production:
    api:
      debug: false
      workers: 8
      timeout: 300
      max_request_size: 26214400  # 25MB
    database:
      echo: false
      pool_size: 20
      max_overflow: 40
      pool_timeout: 60
      pool_recycle: 1800
      pool_pre_ping: true
    security:
      cors_origins: []  # Must be set via environment variables
      jwt:
        expiration_hours: 8
      rate_limiting:
        enabled: true
        requests_per_minute: 500
        burst: 1000
      file_upload:
        max_size_mb: 25
        scan_files: true
      encryption:
        enabled: true
      audit_logging: true
      ip_filtering: true
      csrf_protection: true
    cache:
      redis:
        enabled: true
        host: "production-redis"
        port: 6379
        max_connections: 50
        timeout: 10
        password_required: true
      memory:
        max_size: 5000
        ttl: 7200
    background_tasks:
      max_workers: 16
      queue_size: 1000
      retry_attempts: 5
      retry_delay: 2.0
      
  testing:
    api:
      debug: false
      workers: 1
    database:
      url: "sqlite+aiosqlite:///./data/contract_analyzer_test.db"
      echo: false
      pool_size: 1
      max_overflow: 2
    security:
      rate_limiting:
        enabled: false
      file_upload:
        max_size_mb: 10
        scan_files: false
    cache:
      redis:
        enabled: false
      memory:
        max_size: 100
        ttl: 300
    background_tasks:
      enabled: false